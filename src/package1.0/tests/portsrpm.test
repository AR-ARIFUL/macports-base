package require tcltest 2
namespace import tcltest::*

set pwd [file normalize $argv0]
set pwd [eval file join {*}[lrange [file split $pwd] 0 end-1]]

package require macports 1.0
mportinit
package require portsrpm 1.0
source ./library.tcl
macports_worker_init


test srpm_main {
    Srpm pkg unit test.
} -setup {
    if {[catch {exec which rpmbuild}] != 0} {
	return "FAIL: missing rpm package. try 'port install rpm'"
    }

    global os.platform os.major os.arch epoch destpath package.destpath configure.build_arch
    global subport version revision package.flat maintainers description categories
    global supported_archs portname porturl portdbpath portpath workpath distname filespath license
    env_init

    file mkdir $workpath
    file mkdir $portdbpath

} -body {
    set res [portsrpm::srpm_main]
    puts $res

    return "Srpm pkg successful."
} -result "Srpm pkg successful."


# Covered by rpm_main
# test srpm_pkg
# test make_dependency_list
# test word_wrap
# test write_port_spec

cleanupTests
